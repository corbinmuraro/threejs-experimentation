<!doctype html>
<html lang="en">
<head>
<title>Terrain Testing</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<style>
	body { margin: 0; overflow: hidden; }
</style>
</head>
<body>
<div id="webgl"></div>

<!-- skybox shaders -->
<script type="x-shader/x-vertex" id="sky-vertex">
varying vec3 vWorldPosition;
void main() {
vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
vWorldPosition = worldPosition.xyz;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
</script>
<script type="x-shader/x-fragment" id="sky-fragment">
uniform vec3 topColor;
uniform vec3 bottomColor;
uniform float offset;
uniform float exponent;
varying vec3 vWorldPosition;
void main() {
float h = normalize( vWorldPosition + offset ).y;
gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( h, exponent ), 0.0 ) ), 1.0 );
}
</script>
<!-- /skybox shaders -->


<script src="three.min.js"></script>
<script src="TerrainLoader.js"></script>
<script>

// BASIC SETUP

var width  = window.innerWidth;
var height = window.innerHeight;

var scene = new THREE.Scene();
scene.add(new THREE.AmbientLight(0xeeeeee));

var camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
camera.position.set(0, -20, 5);
camera.rotation.x+=1.2;

var renderer = new THREE.WebGLRenderer({ alpha: true });


// BUILD MARTIAN SKYBOX

var vertexShader = document.getElementById('sky-vertex').textContent;
var fragmentShader = document.getElementById('sky-fragment').textContent;

var uniforms = {
	topColor: {type: "c", value: new THREE.Color(0xb79670)}, bottomColor: {type: "c", value: new THREE.Color(0xc48051)},
	offset: {type: "f", value: 50}, exponent: {type: "f", value: 0.6}
};

var skyMaterial = new THREE.ShaderMaterial({vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms, side: THREE.BackSide, fog: false});

// create Mesh with sphere geometry and add to the scene
var skyBox = new THREE.Mesh( new THREE.SphereGeometry(250, 60, 40), skyMaterial);
this.scene.add(skyBox);

// BUILD MARTIAN TERRAIN

var plane;
renderer.setClearColor( 0xffffff, 0);
renderer.setSize(width, height);
var terrainLoader = new THREE.TerrainLoader();
terrainLoader.load('E.bin', function(data) {
	var geometry = new THREE.PlaneGeometry(60, 60, 999, 999);
	for (var i = 0, l = geometry.vertices.length; i < l; i++) {
		geometry.vertices[i].z = data[i]/ 65535 * 4;		
	}

	var material = new THREE.MeshPhongMaterial({
		map: THREE.ImageUtils.loadTexture('E_brown.jpg')
	});

	plane = new THREE.Mesh(geometry, material);
	plane.position.set(0,0,0);
	scene.add(plane);
});

// RENDER THE SCENE

document.getElementById('webgl').appendChild(renderer.domElement);

render();
function render() {
	requestAnimationFrame(render);
	renderer.render(scene, camera);
}


// NAVIGATION WITH KEYBOARD
document.addEventListener( 'keypress', onDocumentKeyPress, false );
function onDocumentKeyPress( event ) {

        var keyCode = event.which;
        var positionDelta = 70;
        var rotationDelta = 0.1;
        //console.log(keyCode);
        //A
        if ( keyCode == 97 )
        {
            plane.rotation.z += rotationDelta;
        }
        //D
        else if ( keyCode == 100 )
        {
            plane.rotation.z -= rotationDelta;
        }
        //W
        else if ( keyCode == 119 )
        {
            plane.rotation.x += rotationDelta;
        }
        //S
        else if ( keyCode == 115 )
        {
            plane.rotation.x -= rotationDelta;
        }
        // //Q
        // else if ( keyCode == 113 )
        // {
        //     camera.position.y += positionDelta / 100;
        // }
        // //E
        // else if ( keyCode == 101 )
        // {
        //     camera.position.y -= positionDelta / 100;

        // }
        // //T
        // else if ( keyCode == 116 )
        // {
        //     camera.rotation.x += rotationDelta;

        // }
        // //G
        // else if ( keyCode == 103 )
        // {
        //     camera.rotation.x -= rotationDelta;

        // }
        // //F
        // else if ( keyCode == 102 )
        // {
        //     camera.rotation.y += rotationDelta;

        // }
        // //H
        // else if ( keyCode == 104 )
        // {
        //     camera.rotation.y -= rotationDelta;
        // }
    }

</script>
</body>
</html>